<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - Enhanced</title>
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="student-dashboard.css">
    <script src="../js/toast.js"></script>
    <script src="../js/searchable-select.js"></script>

</head>

<body>
    <!-- Date of Birth Completion Modal -->
    <div id="dobModal" class="dob-modal hidden">
        <div class="dob-modal-overlay"></div>
        <div class="dob-modal-content">
            <div class="dob-modal-header">
                <div class="dob-modal-icon">ðŸŽ‚</div>
                <h2>Welcome! Please Complete Your Profile</h2>
                <p>Please enter your date of birth to continue using the dashboard.</p>
            </div>
            <form id="dobForm">
                <div class="dob-form-group">
                    <label for="dobInput">Date of Birth</label>
                    <input type="date" id="dobInput" required max="">
                    <small>This information helps us personalize your experience</small>
                </div>
                <button type="submit" class="dob-btn-primary" id="saveDobBtn">Save & Continue</button>
            </form>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="profile-modal hidden">
        <div class="profile-modal-overlay" onclick="closeProfileModal()"></div>
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h2><i data-lucide="user"></i> My Profile</h2>
                <button class="profile-close-btn" onclick="closeProfileModal()">&times;</button>
            </div>
            <div class="profile-modal-body">
                <!-- Profile Info -->
                <div class="profile-avatar-section">
                    <div class="profile-avatar-large" id="profileAvatar">S</div>
                    <h3 id="profileName">Student</h3>
                    <span class="profile-role-badge">Student</span>
                </div>
                <div class="profile-info-grid">
                    <div class="profile-info-item">
                        <label>Email</label>
                        <span id="profileEmail">â€”</span>
                    </div>
                    <div class="profile-info-item">
                        <label>Gender</label>
                        <span id="profileGender">â€”</span>
                    </div>
                    <div class="profile-info-item">
                        <label>Date of Birth</label>
                        <span id="profileDob">â€”</span>
                    </div>
                    <div class="profile-info-item">
                        <label>Grade</label>
                        <span id="profileGrade">â€”</span>
                    </div>
                    <div class="profile-info-item">
                        <label>Section</label>
                        <span id="profileSection">â€”</span>
                    </div>
                    <div class="profile-info-item">
                        <label>Parent Email</label>
                        <span id="profileParentEmail">â€”</span>
                    </div>
                </div>

                <!-- Change Password Section -->
                <div class="profile-section">
                    <h4><i data-lucide="lock"></i> Change Password</h4>
                    <form id="changePasswordForm" onsubmit="handleChangePassword(event)">
                        <div class="profile-form-group">
                            <label for="currentPassword">Current Password</label>
                            <input type="password" id="currentPassword" required placeholder="Enter current password">
                        </div>
                        <div class="profile-form-group">
                            <label for="newPassword">New Password</label>
                            <input type="password" id="newPassword" required minlength="6" placeholder="Min 6 characters">
                        </div>
                        <div class="profile-form-group">
                            <label for="confirmPassword">Confirm New Password</label>
                            <input type="password" id="confirmPassword" required minlength="6" placeholder="Confirm new password">
                        </div>
                        <button type="submit" class="profile-save-btn" id="changePassBtn">Change Password</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="logo">
            <h1 class="logo-link"><span class="logo-icon" aria-hidden="true">SS</span> <span class="logo-text">Smart
                    School</span></h1>


        </div>
        <div class="ClassG" id="classGrade">Student</div>
        <div class="classS" id="classSection">Section</div>
        <div class="nav-right">

            <button class="icon-btn" id="notificationBtn">
                <i data-lucide="bell"></i>
                <span class="notification-badge" id="notificationCount">3</span>
            </button>
            <a class="attendance" href="./student-attendance.html">Attendance</a>
            <a class="schedule" href="./student-schedule.html">Schedule</a>
            <a class="grades" href="./student-grades.html">Grades</a>
            <div class="user-menu" onclick="toggleUserMenu()" id="userMenuContainer">
                <div class="user-avatar" id="userAvatar">S</div>
                <div>
                    <div class="user-name" id="userName">Student</div>
                    <div class="user-role">Student</div>
                </div>
                <i data-lucide="chevron-down"></i>
                <!-- Dropdown Menu -->
                <div class="user-dropdown" id="userDropdown">
                    <a href="#" onclick="viewProfile(); return false;">
                        <i data-lucide="user"></i> My Profile
                    </a>
                    <hr>
                    <a href="#" onclick="logout(); return false;" class="logout-link">
                        <i data-lucide="log-out"></i> Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Loading State -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p class="loading-text">Loading your dashboard...</p>
        </div>

        <!-- Error State -->
        <div id="error" class="error-message hidden"></div>

        <!-- Dashboard View -->
        <div id="dashboardView" class="hidden">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card clickable" onclick="window.location.href='./student-subjects.html'">
                    <div class="stat-header">
                        <span class="stat-label">Total Subjects</span>
                        <div class="stat-icon icon-subjects">
                            <i data-lucide="book"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalSubjects">0</div>
                    <div class="stat-change link">View Subjects â†’</div>
                </div>
                <div class="stat-card clickable" onclick="window.location.href='./student-tasks.html?filter=pending'">
                    <div class="stat-header">
                        <span class="stat-label">Pending Tasks</span>
                        <div class="stat-icon icon-tasks">
                            <i data-lucide="clipboard-list"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="pendingTasks">0</div>
                    <div class="stat-change link">View Pending â†’</div>
                </div>
                <div class="stat-card clickable" onclick="window.location.href='./student-grades.html'">
                    <div class="stat-header">
                        <span class="stat-label">Avg Grade</span>
                        <div class="stat-icon icon-grade">
                            <i data-lucide="trending-up"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="avgGrade">--</div>
                    <div class="stat-change link">View All Grades â†’</div>
                </div>
                <div class="stat-card clickable" onclick="window.location.href='./student-tasks.html?filter=completed'">
                    <div class="stat-header">
                        <span class="stat-label">Completed</span>
                        <div class="stat-icon icon-completed">
                            <i data-lucide="check-circle"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="completedTasks">0</div>
                    <div class="stat-change link">View Completed â†’</div>
                </div>
            </div>

            <!-- Student Charts Section -->
            <div class="student-charts-section">
                <div class="student-charts-grid">
                    <!-- Attendance Chart -->
                    <div class="student-chart-card">
                        <div class="student-chart-header">
                            <h3><i data-lucide="calendar-check"></i> My Attendance</h3>
                        </div>
                        <div class="student-chart-container">
                            <canvas id="studentAttendanceChart"></canvas>
                        </div>
                    </div>

                    <!-- Tasks Progress Chart -->
                    <div class="student-chart-card">
                        <div class="student-chart-header">
                            <h3><i data-lucide="clipboard-list"></i> Tasks Progress</h3>
                        </div>
                        <div class="student-chart-container">
                            <canvas id="studentTasksChart"></canvas>
                        </div>
                    </div>

                    <!-- Subject Performance Chart -->
                    <div class="student-chart-card">
                        <div class="student-chart-header">
                            <h3><i data-lucide="bar-chart-2"></i> Subject Performance</h3>
                        </div>
                        <div class="student-chart-container">
                            <canvas id="studentSubjectChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- Left Column -->
                <div>
                    <!-- Today's Schedule -->
                    <div class="card card-mb-24">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i data-lucide="calendar-clock"></i>
                                Today's Schedule
                            </h2>
                            <span class="today-date" id="todayDate"></span>
                        </div>
                        <div id="todaySchedule"></div>
                    </div>

                    <!-- My Subjects -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i data-lucide="book-open"></i>
                                My Subjects
                            </h2>
                        </div>
                        <div class="subjects-grid" id="subjectsGrid"></div>
                    </div>
                </div>

                <!-- Right Column - Upcoming Tasks -->
                <div>
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i data-lucide="alert-circle"></i>
                                Upcoming Tasks
                            </h2>
                            <a href="#" class="view-all-link" onclick="viewAllTasks(); return false;">
                                View All
                                <i data-lucide="arrow-right"></i>
                            </a>
                        </div>
                        <div class="filter-bar">
                            <button class="filter-btn active" onclick="filterTasks('all')">All</button>
                            <button class="filter-btn" onclick="filterTasks('assignment')">Assignments</button>
                            <button class="filter-btn" onclick="filterTasks('quiz')">Quizzes</button>
                        </div>
                        <div id="upcomingTasks"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Subject Detail View (keeping your original structure) -->
        <div id="subjectView" class="hidden">
            <button class="back-btn" id="backToDashboard">
                <i data-lucide="arrow-left"></i>
                Back to Dashboard
            </button>

            <div class="card">
                <h1 id="subjectTitle" class="subject-title"></h1>
                <p id="subjectTeacher" class="subject-teacher"></p>

                <!-- Subject Stats -->
                <div class="stats-grid subject-stats">
                    <div class="stat-card">
                        <div class="stat-label">Grade</div>
                        <div class="stat-value" id="subjectGrade">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Assignments</div>
                        <div class="stat-value" id="subjectAssignments">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Quizzes</div>
                        <div class="stat-value" id="subjectQuizzes">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Classes/Week</div>
                        <div class="stat-value" id="subjectClasses">0</div>
                    </div>
                </div>

                <!-- Schedule Info -->
                <div class="subject-schedule-section">
                    <h3 class="subject-schedule-heading">
                        <i data-lucide="calendar"></i>
                        Class Schedule
                    </h3>
                    <div id="subjectScheduleGrid" class="subject-schedule-grid">
                    </div>
                </div>

                <!-- Tabs for Content -->
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('announcements')">Announcements</button>
                    <button class="tab" onclick="switchTab('assignments')">Assignments</button>
                    <button class="tab" onclick="switchTab('quizzes')">Quizzes</button>
                </div>

                <div id="announcementsTab">
                    <div id="announcementsList"></div>
                </div>
                <div id="assignmentsTab" class="hidden">
                    <div id="assignmentsList"></div>
                </div>
                <div id="quizzesTab" class="hidden">
                    <div id="quizzesList"></div>
                </div>
            </div>
        </div>

        <!-- Detail View (keeping your original) -->
        <div id="detailView" class="hidden"></div>
    </div>
    <script src="student-dashboard.js"></script>
</body>

</html>